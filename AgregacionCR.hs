-- Aquí vamos a hacer el algoritmo de agregación con el manejo de restricciones